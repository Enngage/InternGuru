@using UI.Helpers;
@using UI.Extensions;
@using Core.Helpers;
@using PagedList.Mvc
@model UI.Builders.Auth.Views.AuthIndexView

@{
    ViewBag.Title = "Můj profil";
    Layout = "~/Views/Auth/AuthMaster.cshtml";

}

@Html.RequireScript("/scripts/views/auth/authIndex")

<div class="ui secondary pointing menu w-auth-menu">
    <a class="item active" data-tab="first">
        Konverzace
        @if (Model.Master.StatusBox.NewMessagesCount > 0)
        {
            <span class="w-color-secondary">&nbsp;(@Model.Master.StatusBox.NewMessagesCount)</span>
        }
    </a>
    <a class="item" data-tab="second">
        Stáže <span class="w-font-light">&nbsp;(@Model.AuthMaster.Internships.Count())</span>
    </a>
    <a class="item" data-tab="third">
        Závěrečné práce <span class="w-font-light">&nbsp;(@Model.AuthMaster.Theses.Count())</span>
    </a>
    <a class="item w-mobile-show" data-tab="mobileOnly">
        Další
    </a>
    <div class="right menu w-mobile-hide">
        @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "_MainLogoutForm" }))
        {
            @Html.AntiForgeryToken()
            <a class="ui item" href="javascript:document.getElementById('_MainLogoutForm').submit()">
                <i class="sign out icon"></i>
                Odhlásit
            </a>
        }
    </div>
</div>

<div class="ui tab segment active" data-tab="first">

    @if (!Model.AuthMaster.Conversations.Any())
            {
        @Html.RenderInfoMessage("Dosud nemáš žádné zprávy")
    }
    else
    {
        <div class="ui items divided">
            @foreach (var conversation in Model.AuthMaster.Conversations)
            {
                var segmentClass = conversation.IsRead ? string.Empty : "w-segment-dark basic";
                <div class="item w-override-padding-all @segmentClass">
                    <a class="ui tiny image w-mobile-margin-0" href="@Url.Action("Conversation", new { id = conversation.ConversationID })">
                        <img alt="" class="ui tiny image" src="@ImageHelper.GetTransparentImage()" data-src="@ImageHelper.GetUserAvatar(conversation.WithApplicationUserName)">
                    </a>
                    <div class="content">
                        <a class="header" href="@Url.Action("Conversation", new { id = conversation.ConversationID })">
                            @if (conversation.WrittenByCurrentUser)
                            {
                                <span>@(!string.IsNullOrEmpty(conversation.RecipientFirstName) ? conversation.RecipientFirstName + " " + conversation.RecipientLastName : conversation.RecipientApplicationUserName)</span>
                            }
                            else
                            {
                                <span>@(!string.IsNullOrEmpty(conversation.SenderFirstName) ? conversation.SenderFirstName + " " + conversation.SenderLastName : conversation.SenderApplicationUserName)</span>
                            }
                        </a>
                        <div class="meta w-font-size-small">
                            <i class="calendar icon"></i>@DateHelper.FormatTime(conversation.MessageCreated) |
                            @if (conversation.IsRead)
                            {
                                <i title="Přečteno" class="checkmark green icon"></i><span>přečteno</span>
                            }
                            else
                            {
                                <i title="Nepřečteno" class="remove red icon"></i><span>nepřečteno</span>
                            }
                            @(!string.IsNullOrEmpty(conversation.Subject) ? " | " + conversation.Subject : null)
                        </div>
                        <div class="description">
                            <a class="w-auth-conversation-text-link" href="@Url.Action("Conversation", new { id = conversation.ConversationID })">
                                @StringHelper.ShortenText(conversation.MessageText, 200)
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        if (Model.ConversationsPaged.PageCount > 1)
        {
            @Html.PagedListPager(Model.ConversationsPaged, page => Url.Action("Index", "Auth", new { page }), new PagedListRenderOptions() { MaximumPageNumbersToDisplay = 6 })
        }
    }
</div>

<div class="ui tab segment" data-tab="second">

    @if (Model.Master.CurrentCompany.IsAvailable)
            {
                if (!Model.AuthMaster.Internships.Any())
                {
            @Html.RenderInfoMessage("Dosud nebyly vystaveny žádné nabídky stáže")
        }
        else
        {
            <table class="ui very basic table">
                <thead>
                    <tr>
                        <th>
                            Akce
                        </th>
                        <th>
                            Název stáže
                        </th>
                        <th>
                            Vytvořeno
                        </th>
                        <th>
                            Status
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var internship in Model.AuthMaster.Internships)
                    {
                        <tr>
                            <td class="collapsing w-body-text-center w-mobile-left">
                                <a href="@Url.Action("EditInternship", new { id = internship.ID })">
                                    <i title="Upravit" class="edit icon black"></i>
                                </a>
                            </td>
                            <td>
                                <a href="@Url.Action("Index", "Internship", new { id = internship.ID, codeName = internship.CodeName })">
                                    @internship.Title
                                </a>
                            </td>
                            <td class="collapsing w-mobile-left w-tablet-hide w-font-size-small">
                                <i title="Vytvořeno" class="calendar icon"></i>
                                @DateHelper.FormatDate(internship.Created)
                            </td>
                            <td class="collapsing w-body-text-right w-mobile-left">
                                @if (internship.IsActive)
                                {
                                    <i title="Aktivní" class="checkmark green icon"></i>
                                }
                                else
                                {
                                    <i title="Neaktivní" class="remove red icon"></i>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    }
    else
    {
        @Html.RenderInfoMessage("Pro přidání inzerátu musíte vytvořit firmu")
    }
</div>

<div class="ui tab segment" data-tab="third">
    @if (!Model.AuthMaster.Theses.Any())
    {
        @Html.RenderInfoMessage("Dosud nebyly vystaveny žádné práce")
    }
    else
    {
        <table class="ui very basic table">
            <thead>
                <tr>
                    <th>
                        Akce
                    </th>
                    <th>
                        Název práce
                    </th>
                    <th>
                        Vytvořeno
                    </th>
                    <th>
                        Status
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var thesis in Model.AuthMaster.Theses)
                {
                    <tr>
                        <td class="collapsing w-body-text-center w-mobile-left">
                            <a href="@Url.Action("EditThesis", new { id = thesis.ID })">
                                <i title="Upravit" class="edit icon black"></i>
                            </a>
                        </td>

                        <td>
                            <a href="@Url.Action("Index", "Thesis", new { id = thesis.ID, codeName = thesis.CodeName })">
                                @thesis.ThesisName
                            </a>
                        </td>
                        <td class="collapsing w-mobile-left w-tablet-hide w-font-size-small">
                            <i class="calendar icon"></i>
                            @DateHelper.FormatDate(thesis.Created)
                        </td>
                        <td class="collapsing w-body-text-right w-mobile-left">
                            @if (thesis.IsActive)
                            {
                                <i title="Aktivní" class="checkmark green icon"></i>
                            }
                            else
                            {
                                <i title="Neaktivní" class="remove red icon"></i>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

<div class="ui tab segment" data-tab="mobileOnly">
    <div class="ui list">
        <div class="item">
            <a href="@Url.Action("EditProfile")">Upravit profil</a>
        </div>
        <div class="item">
            @if (Model.Master.CurrentCompany.IsAvailable)
            {
                <a href="@Url.Action("EditCompany")">Upravit firmu</a>

            }
            else
            {
                <a href="@Url.Action("RegisterCompany")">Vytvořit firmu</a>

            }
        </div>
        <div class="item">
            <a href="@Url.Action("NewInternship")">Inzerovat novou stáž</a>
        </div>
        <div class="item">
            <a href="@Url.Action("NewThesis")">Zadat závěrečnou práci</a>
        </div>
    </div>

    <div class="ui list">
        <div class="item">
            @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "_MobileLogoutForm" }))
            {
                @Html.AntiForgeryToken()
                <a class="ui item" href="javascript:document.getElementById('_MobileLogoutForm').submit()">
                    Odhlásit
                </a>
            }
        </div>
    </div>
</div>
